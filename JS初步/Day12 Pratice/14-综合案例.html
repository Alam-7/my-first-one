<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      .list {
        width: 990px;
        margin: 100px auto 0;
      }

      .item {
        padding: 15px;
        transition: all 0.5s;
        display: flex;
        border-top: 1px solid #e4e4e4;
      }

      .item:nth-child(4n) {
        margin-left: 0;
      }

      .item:hover {
        cursor: pointer;
        background-color: #f5f5f5;
      }

      .item img {
        width: 80px;
        height: 80px;
        margin-right: 10px;
      }

      .item .name {
        font-size: 18px;
        margin-right: 10px;
        color: #333;
        flex: 2;
      }

      .item .name .tag {
        display: block;
        padding: 2px;
        font-size: 12px;
        color: #999;
      }

      .item .price,
      .item .sub-total {
        font-size: 18px;
        color: firebrick;
        flex: 1;
      }

      .item .price::before,
      .item .sub-total::before,
      .amount::before {
        content: "¥";
        font-size: 12px;
      }

      .item .spec {
        flex: 2;
        color: #888;
        font-size: 14px;
      }

      .item .count {
        flex: 1;
        color: #aaa;
      }

      .total {
        width: 990px;
        margin: 0 auto;
        display: flex;
        justify-content: flex-end;
        border-top: 1px solid #e4e4e4;
        padding: 20px;
      }

      .total .amount {
        font-size: 18px;
        color: firebrick;
        font-weight: bold;
        margin-right: 50px;
      }
    </style>
  </head>

  <body>
    <div class="list">
      <!-- <div class="item">
      <img src="https://yanxuan-item.nosdn.127.net/84a59ff9c58a77032564e61f716846d6.jpg" alt="">
      <p class="name">称心如意手摇咖啡磨豆机咖啡豆研磨机 <span class="tag">【赠品】10优惠券</span></p>
      <p class="spec">白色/10寸</p>
      <p class="price">289.90</p>
      <p class="count">x2</p>
      <p class="sub-total">579.80</p>
    </div> -->
    </div>
    <div class="total">
      <div>合计：<span class="amount">1000.00</span></div>
    </div>
    <script>
      const goodsList = [
        {
          id: "4001172",
          name: "称心如意手摇咖啡磨豆机咖啡豆研磨机",
          price: 289.9,
          picture:
            "https://yanxuan-item.nosdn.127.net/84a59ff9c58a77032564e61f716846d6.jpg",
          count: 2,
          spec: { size: "10寸", color: "白色" },
        },
        {
          id: "4001009",
          name: "竹制干泡茶盘正方形沥水茶台品茶盘",
          price: 109.8,
          picture:
            "https://yanxuan-item.nosdn.127.net/2d942d6bc94f1e230763e1a5a3b379e1.png",
          count: 3,
          spec: { size: "40cm*40cm", color: "黑色" },
        },
        {
          id: "4001874",
          name: "古法温酒汝瓷酒具套装白酒杯莲花温酒器",
          price: 488,
          picture:
            "https://yanxuan-item.nosdn.127.net/44e51622800e4fceb6bee8e616da85fd.png",
          count: 1,
          spec: { color: "青色", sum: "一大四小" },
        },
        {
          id: "4001649",
          name: "大师监制龙泉青瓷茶叶罐",
          price: 139,
          picture:
            "https://yanxuan-item.nosdn.127.net/4356c9fc150753775fe56b465314f1eb.png",
          count: 1,
          spec: { size: "小号", color: "紫色" },
          gift: "50g茶叶,清洗球,宝马, 奔驰",
        },
      ];
      //实现功能：将数据库中的数据依照原来的html格式渲染到页面（其中需要重点注意对各种来自后台数据的处理方法）  然后将所有的费用求和汇总到下面的total
      //问题：1.怎么给数据渲染到页面上？原来的都是html文本  将处理后的数据用循环的方式依照模板字符串一次添加到list中？
      // 2.怎么实现数据的处理并整合

      //1.数据处理 直接丢到模板字符串中？
      // const list = document.querySelector(".list");
      //循环添加
      //   goodsList.forEach((item) => {
      //     list.appendChild(`<div class="item">
      //   <img src=${item.picture} alt="">
      //   <p class="name">${item.name}<span class="tag">【赠品】10优惠券</span></p>
      //   <p class="spec">${Object.values(item.spec).join("/")}</p>
      //   <p class="price">${item.price.toFixed(2)}</p>
      //   <p class="count">x${item.count}</p>
      //   <p class="sub-total">${item.count * item.price}</p>
      // </div> `);
      //   });
      //1.添加节点的方式不对   一般渲染的处理都是根据给出的数据库数组，对其中的对象元素进行修改，使之形成一块一块完整的html文本字符串然后添加到list 2.每次都有item.非常冗余麻烦  需要解构

      //修改：
      //1.获取父节点：
      const list = document.querySelector(".list");
      //2.直接修改数据库同时赋值给list （对数组 字符串 对象之间各种方法的转换）
      list.innerHTML = goodsList
        .map((item) => {
          //直接用map函数对对象数组进行处理 但是返回数组 因而最后还需要合并一下
          // 2.1首先对该item对象进行解构
          const { name, price, picture: src, count, spec, gift } = item;
          //2.2对各个数据组块进行处理
          //2.2.1价格保留两位小数
          // price = price.toFixed(2);
          //2.2.2spec需要拼接
          const text = Object.values(spec).join("/"); //注意不能直接赋值给spec 其原本是个对象(虽然是弱类型语言但可能也有一定的类型规范)
          //2.2.3gift需要判断有无 如果没有就不管 如果有需要处理为所需格式(因为可能有多个赠品 所以需要直接修改为标签)
          const str = gift
            ? gift
                .split(",")
                .map((e) => `<span class="tag">【赠品】${e}</span>`)
                .join("")
            : ""; //没有就是空
          //2.3返回渲染
          return ` <div class="item">
      <img src=${src} alt="">
      <p class="name">${name} ${str}</p>
      <p class="spec">${text}</p>
      <p class="price">${price.toFixed(2)}</p>
      <p class="count">x${count}</p>
      <p class="sub-total">${count * price}</p>
    </div> `;
        })
        .join("");

      //3.总价的计算  reduce之前所有的价格即可
      const total = goodsList.reduce(
        (prev, item) => prev + item.price * item.count,
        0
      );
      // console.log(total);
      //发现可能是因为有小数导致计数不准 需要在计算前提前矫正
      document.querySelector(".amount").innerHTML = total.toFixed(2);
      //
      //
      //
      //
      //
      //
      //
      //
      //
      //
      //
      //
      //
      //
      //
      //
      //
      //  // 1. 根据数据渲染页面
      //     document.querySelector('.list').innerHTML = goodsList.map(item => {
      //       // console.log(item)  // 每一条对象
      //       // 对象解构  item.price item.count
      //       const { picture, name, count, price, spec, gift } = item
      //       // 规格文字模块处理
      //       const text = Object.values(spec).join('/')
      //       // 计算小计模块 单价 * 数量  保留两位小数
      //       // 注意精度问题，因为保留两位小数，所以乘以 100  最后除以100
      //       const subTotal = ((price * 100 * count) / 100).toFixed(2)
      //       // 处理赠品模块 '50g茶叶,清洗球'
      //       const str = gift ? gift.split(',').map(item => `<span class="tag">【赠品】${item}</span> `).join('') : ''
      //       return `
      //         <div class="item">
      //           <img src=${picture} alt="">
      //           <p class="name">${name} ${str} </p>
      //           <p class="spec">${text} </p>
      //           <p class="price">${price.toFixed(2)}</p>
      //           <p class="count">x${count}</p>
      //           <p class="sub-total">${subTotal}</p>
      //         </div>
      //       `
      //     }).join('')

      //     // 3. 合计模块
      //     const total = goodsList.reduce((prev, item) => prev + (item.price * 100 * item.count) / 100, 0)
      //     // console.log(total)
      //     document.querySelector('.amount').innerHTML = total.toFixed(2)
    </script>
  </body>
</html>
